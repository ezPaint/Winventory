<?xml version="1.0" encoding="UTF-8"?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.simoncomputing.app.winventory.dao.EventToSoftwareDao">
    <!-- PROTECTED CODE -->
    
    <resultMap id="EventMapper" type="com.simoncomputing.app.winventory.domain.Event">
        <result column ="KEY"                 property = "key" />
        <result column ="DATE_CREATED"        property = "dateCreated" />
        <result column ="DESCRIPTION"         property = "description" />
        <result column ="CATEGORY"            property = "category" />
    </resultMap>
    
    <resultMap id="SoftwareMapper" type="com.simoncomputing.app.winventory.domain.Software">
        <result column ="KEY"                 property = "key" />
        <result column ="TYPE"                property = "type" />
        <result column ="DESCRIPTION"         property = "description" />
        <result column ="COST"                property = "cost" />
        <result column ="SERIAL_NO"           property = "serialNo" />
        <result column ="CONDITION"           property = "condition" />
        <result column ="LOCATION_ID"         property = "locationId" />
        <result column ="USER_ID"             property = "userId" />
        <result column ="PURCHASE_DATE"       property = "purchaseDate" />
    </resultMap>
    
    
	<!-- Gets all of the Events associated with a Software -->
	<select id='getEventsBySoftwareId' resultMap='EventMapper'>
		SELECT * FROM Event e
   		INNER JOIN Event_To_Software map ON e.key = map.event_id
		WHERE map.Software_id = #{param1}
	</select>
	
	
	
	<select id='getSoftwareByEventId' resultMap='SoftwareMapper'>
		SELECT * FROM Software h
   		INNER JOIN Event_To_Software map ON h.key = map.Software_id
		WHERE map.event_id = #{param1}
	</select>
	
	<insert id="link" parameterType="map">
        insert into EVENT_TO_Software
        (
            EVENT_ID , Software_ID
        )
        values
        (
            #{param1} , #{param2}
        )
    </insert>
    

    <delete id="unlink" parameterType="map">
        delete from EVENT_TO_Software
        where SoftwareId=#{param2} AND eventId=#{param1};
    </delete>
    
</mapper>